<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Väder från YR</title>
        <style>
        :root {
            --gr: 1.61803398875em;
        }

        body {
            margin: var(--gr);
            font-family: system-ui;
        }

        figure {
            width: calc(5 * var(--gr));
        }

        img {
            width: 100%;
        }

        header {
            border-bottom: 1px solid #666;
        }
        </style>
    </head>
    <body>
        <header>
            <h1>Väder från YR</h1>
        </header>
        <form action="/">
        <label for="placeSearch">Sök efter din plats:</label>
        <input list="placeSuggestions" id="placeSearch" name="q" />
        <datalist id="placeSuggestions"></datalist>
        <button>Visa</button>
        </form>
        <script>
        let ac;

        async function getSuggestions (q) {
            const res = await fetch('/suggestions?q=' + q);
            const json = await res.json();

            return json;
        }

        async function renderSuggestions (e) {
            const suggestions = await getSuggestions(e.target.value);

            window.placeSuggestions.innerHTML = suggestions.map(s => '<option value="'+s.name+'">').join('');
        }

        window.placeSearch.addEventListener('input', e => {
            if (ac) {
                ac.abort();
            }

            ac = new AbortController();

            try {
                renderSuggestions(e, { signal: ac.signal });
            } catch (e) {
                console.error(e);
            }
        });
        </script>
    </body>
</html>